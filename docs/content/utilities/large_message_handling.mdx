---
title: Large Message Handling
description: Utility
---



The large message handling utility is used to handle SQS messages which have had their payloads
offloaded to S3 due to them being larger than the SQS maximum.

The utility automatically retrieves and deletes messages which have been offloaded to S3 using the
[amazon-sqs-java-extended-client-lib](https://github.com/awslabs/amazon-sqs-java-extended-client-lib)
client library.

This utility is compatible with versions 1.1.0+ of amazon-sqs-java-extended-client-lib.</p>

```xml
<dependency>
    <groupId>com.amazonaws</groupId>
    <artifactId>amazon-sqs-java-extended-client-lib</artifactId>
    <version>1.1.0</version>
</dependency>
```

## Install

Add the following dependency to your project.

```xml
<dependency>
    <groupId>software.amazon.lambda</groupId>
    <artifactId>powertools-sqs</artifactId>
</dependency>
```

The annotation `@LargeMessageHandler` should be used with the handleRequest method of a class
which implements `com.amazonaws.services.lambda.runtime.RequestHandler` with
`com.amazonaws.services.lambda.runtime.events.SQSEvent` as the first parameter.

```java
public class SqsMessageHandler implements RequestHandler<SQSEvent, String> {

    @Override
    @LargeMessageHandler
    public String handleRequest(SQSEvent sqsEvent, Context context) {
    // process messages

    return "ok";
}
```

`@LargeMessageHandler` creats a default S3 Client `AmazonS3 amazonS3 = AmazonS3ClientBuilder.defaultClient()`.
When the Lambda function is invoked with an event from SQS, each record received
in the SQSEvent will be checked to see if it's body contains a payload which has
been offloaded to S3. If it does then `getObject(bucket, key)` will be called
and the payload retrieved.

*Note*: Retreiving payloads from S3 will increase the duration of the Lambda function.

If the request handler method returns then each payload will be deleted from S3
using `deleteObject(bucket, key)}`

To disable deletion of payloads setting the following annotation parameter:

```java
@LargeMessageHandler(deletePayloads=false)
```